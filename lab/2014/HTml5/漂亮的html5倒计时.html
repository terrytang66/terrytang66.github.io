<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Beautiful timerControler</title>
</head>
<body style="height:100%;">
	<canvas id="canvas" style="height:100%;">
		当前浏览器不支持
	</canvas>
	<script type="text/javascript">
	var digit =
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0]
        ]//:
    ];
    var window_width=1024;
	var window_height=768;
	var radius=8;
	var margin_top=60;
	var margin_left=30;

	const endTime=new Date(2014,9,31,18,47,52);
	var  curShoeTimeSeconds=0;

    // var ball={x:512,y:100,r:20,g:2,vx:-4,vy:0,color:"blue"};
    var balls=[];
    const  colors=["#33b5e5","#0099cc","#aa66cc","#9933cc","#99cc00","#669900","#ffbb33","$ff8800","#ff4444","#cc000000"];

	window.onload=function(){
		window_width=document.body.clientWidth;
        window_height=document.body.clientHeight;
        
        margin_left=Math.round(window_width/10);
        radius=Math.round(window_width*4/5/108)-1;
        margin_top=Math.round(window_height*1/5);
	    var canvas=document.getElementById("canvas");
	    
	    canvas.width=window_width;
	    canvas.height=window_height;
	    curShoeTimeSeconds=getCurrentShowTime();
	    
	    var context=canvas.getContext('2d');//所有绘图基于这个
	   
       
        setInterval(function(){
	    	render(context);
	    	update();
   		 },50);
    }
    function getCurrentShowTime(){
    	var curTime=new Date();
    	var ret=endTime.getTime()-curTime.getTime();
    	ret=Math.round(ret/1000);
    	return ret>=0?ret:0;
    }
    function update(){
    	var nextShowTime=getCurrentShowTime();

    	var nexthours=parseInt(nextShowTime/3600);
    	var nextminutes=parseInt((nextShowTime-(nexthours*3600))/60);
    	var nextseconds=(nextShowTime%60);

    	var curhours=parseInt(curShoeTimeSeconds/3600);
    	var curminutes=parseInt((curShoeTimeSeconds-(curhours*3600))/60);
    	var curseconds=(curShoeTimeSeconds%60);

    	if (nextseconds != curseconds) {
    		if (parseInt(curhours/10)!=parseInt(nexthours/10)) {
                addBalls(margin_left+0,margin_top,parseInt(curhours/10));
            };
            if (parseInt(curhours%10)!=parseInt(nexthours%10)) {
                addBalls(margin_left+15*(radius+1),margin_top,parseInt(curhours/10));
            };
            if (parseInt(curminutes/10)!=parseInt(nextminutes/10)) {
                addBalls(margin_left+39*(radius+1),margin_top,parseInt(curminutes/10));
            };
            if (parseInt(curminutes%10)!=parseInt(nextminutes%10)) {
                addBalls(margin_left+54*(radius+1),margin_top,parseInt(curminutes/10));
            };
            if (parseInt(curseconds/10)!=parseInt(nextseconds/10)) {
                addBalls(margin_left+78*(radius+1),margin_top,parseInt(curseconds/10));
            };
            if (parseInt(curseconds%10)!=parseInt(nextseconds%10)) {
                addBalls(margin_left+93*(radius+1),margin_top,parseInt(curseconds/10));
            };
            curShoeTimeSeconds=nextShowTime;

    	};

        updateBalls();
        console.log(balls.length);
    }
    function updateBalls(){
        for(var i = 0, length1 = balls.length; i < length1; i++){
           balls[i].x+=balls[i].vx;
           balls[i].y+=balls[i].vy;
           balls[i].vy+=balls[i].g;
           if (balls[i].y>=window_height-radius) {
              balls[i].y=window_height-radius;
              balls[i].vy=-balls[i].vy*0.75;
           }

        }
        var cnt=0;
        for(var i = 0, length1 = balls.length; i < length1; i++)
            if (balls[i].x+radius>0 && balls[i].x-radius<window_width) 
              balls[cnt++]=balls[i];

           while(balls.length>Math.min(200,cnt)){
             balls.pop();
        }
    }
    function addBalls(x,y,num){
        for (var i = 0; i < digit[num].length; i++) {
            for(var j = 0;j < digit[i].length;j++){
                if (digit[num][i][j]==1) {
                    var aBall={
                        x:x+j*2*(radius+1)+(radius+1),
                        y:y+i*2*(radius+1)+(radius+1),
                        g:1.5+Math.random(),
                        vx:Math.pow(-1,Math.ceil(Math.random()*1000))*4,
                        vy:-5,
                        color:colors[Math.floor(Math.random()*colors.length)]
                    }
                    balls.push(aBall);
                };
            }
        };
    }
    function render(cxt){
        cxt.clearRect(0,0,window_width,window_height);//对矩形空间内进行刷新

    	var hours=parseInt(curShoeTimeSeconds/3600);
    	var minutes=parseInt((curShoeTimeSeconds-(hours*3600))/60);
    	var seconds=(curShoeTimeSeconds%60);

    	renderDigit(margin_left,margin_top,parseInt(hours/10),cxt);
    	renderDigit(margin_left+15*(radius+1),margin_top,parseInt(hours%10),cxt);
    	renderDigit(margin_left+30*(radius+1),margin_top,10,cxt);
    	renderDigit(margin_left+40*(radius+1),margin_top,parseInt(minutes/10),cxt);
    	renderDigit(margin_left+55*(radius+1),margin_top,parseInt(minutes%10),cxt);
    	renderDigit(margin_left+70*(radius+1),margin_top,10,cxt);
    	renderDigit(margin_left+80*(radius+1),margin_top,parseInt(seconds/10),cxt);
    	renderDigit(margin_left+95*(radius+1),margin_top,parseInt(seconds%10),cxt);

        for(var i = 0, length1 = balls.length; i < length1; i++){
            cxt.fillStyle=balls[i].color;
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,radius,0,2*Math.PI,true);
            cxt.closePath();
            cxt.fill();
        }

    }
    function renderDigit(x,y,num,cxt){
    	cxt.fillStyle="rgb(0,102,153)";
    	for (var i = 0; i < digit[num].length; i++) {
    		for (var j = 0; j < digit[num][i].length; j++) {
    			if(digit[num][i][j]==1){
    				cxt.beginPath();
    				cxt.arc(x+j*2*(radius+1)+(radius+1),y+i*2*(radius+1)+(radius+1),radius,0,2*Math.PI);
    				cxt.closePath();
    				cxt.fill();
    			}
    		};
    	};
    }

	</script>
</body>
</html>